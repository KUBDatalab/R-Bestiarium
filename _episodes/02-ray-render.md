---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 02-ray-render.md in _episodes_rmd/
title: "Rayrender højdemodeller"
teaching: 0
exercises: 0
questions:
- "Key question (FIXME)"
objectives:
- "First learning objective. (FIXME)"
keypoints:
- "First key point. Brief Answer to questions. (FIXME)"
---





Den her ser pænt cool ud:
<div class="figure" style="text-align: center">
<img src="../fig/taiwan.jpg" alt="plot of chunk taiwan.jpg-visning" width="400px" />
<p class="caption">plot of chunk taiwan.jpg-visning</p>
</div>

Det er et reliefkort af Taiwan. Lavet af https://mobile.twitter.com/researchremora

#Hvordan?
Vi skal bruge disse biblioteker:

~~~
library(rgdal)
~~~
{: .language-r}



~~~
Loading required package: sp
~~~
{: .output}



~~~
The legacy packages maptools, rgdal, and rgeos, underpinning the sp package,
which was just loaded, will retire in October 2023.
Please refer to R-spatial evolution reports for details, especially
https://r-spatial.org/r/2023/05/15/evolution4.html.
It may be desirable to make the sf package available;
package maintainers should consider adding sf to Suggests:.
The sp package is now running under evolution status 2
     (status 2 uses the sf package in place of rgdal)
~~~
{: .output}



~~~
Please note that rgdal will be retired during October 2023,
plan transition to sf/stars/terra functions using GDAL and PROJ
at your earliest convenience.
See https://r-spatial.org/r/2023/05/15/evolution4.html and https://github.com/r-spatial/evolution
rgdal: version: 1.6-7, (SVN revision 1203)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 3.0.4, released 2020/01/28
Path to GDAL shared files: /usr/share/gdal
GDAL binary built with GEOS: TRUE 
Loaded PROJ runtime: Rel. 6.3.1, February 10th, 2020, [PJ_VERSION: 631]
Path to PROJ shared files: /usr/share/proj
Linking to sp version:2.0-0
To mute warnings of possible GDAL/OSR exportToProj4() degradation,
use options("rgdal_show_exportToProj4_warnings"="none") before loading sp or rgdal.
~~~
{: .output}



~~~
library(dplyr)
~~~
{: .language-r}



~~~

Attaching package: 'dplyr'
~~~
{: .output}



~~~
The following objects are masked from 'package:stats':

    filter, lag
~~~
{: .output}



~~~
The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union
~~~
{: .output}



~~~
library(rayshader)
~~~
{: .language-r}



~~~
Warning in rgl.init(initValue, onlyNULL): RGL: unable to open X11 display
~~~
{: .warning}



~~~
Warning: 'rgl.init' failed, running with 'rgl.useNULL = TRUE'.
~~~
{: .warning}



~~~
library(elevatr)
~~~
{: .language-r}



~~~
elevatr v0.4.5 NOTE: This is the last version of 'elevatr' that will use the 
'sp' and 'raster' packages. The next release will switch to 'sf' and 'terra'.
~~~
{: .output}



~~~
library(raster)
~~~
{: .language-r}



~~~

Attaching package: 'raster'
~~~
{: .output}



~~~
The following object is masked from 'package:dplyr':

    select
~~~
{: .output}

Nu prøver vi så at gøre det for danmark. Indlæs en rds-fil, der indeholder 
et `sf` objekt:

~~~
denmark <- readRDS(url("https://geodata.ucdavis.edu/gadm/gadm4.0/Rsf/gadm40_DNK_0_sf.rds"))
~~~
{: .language-r}
Så skal vi have højdedata. Dem kan funktionen `get_elev_raster` trække fra 
"Amazon Web Services Terrain Tiles and the Open Topography global datasets API":


~~~
dem <- get_elev_raster(denmark, z = 6)
~~~
{: .language-r}

Så laver vi et nyt `raster` objekt, hvor vi trækker de relevante dele ud af
højdedata. Vi maskerer højdedata med sf-objektet for Danmark:

~~~
denmark_dem <- raster::mask(dem, denmark)
~~~
{: .language-r}

Dernæst konverterer vi rasteren til en matrix som rayshaderpakken kan arbejde med:

~~~
denmark_mat <- rayshader::raster_to_matrix(denmark_dem)
~~~
{: .language-r}

Og så laver vi 3D-plottet af Danmark. Det gør vi ikke her, for det kan GitHub 
ikke gøre for os. Bemærk også at der er forældede funktioner i brug her - 
der er kommet nye. Så denne kode skal nok opdateres:

~~~
denmark_mat %>% 
  sphere_shade(texture= "imhof3") %>% 
   plot_3d(denmark_mat, windowsize = c(1200,1200),
                     zscale = 20, zoom = 0.75, phi = 89, theta = 0, fov = 0, background = "black")
~~~
{: .language-r}

Endelig kan vi gemme filen

~~~
render_snapshot(filename = "../fig/denmark2.png", samples = 100, width = 6000, height = 6000)
~~~
{: .language-r}

Og det ser således ud:
<div class="figure" style="text-align: center">
<img src="../fig/denmark2.png" alt="plot of chunk vis-plot" width="400px" />
<p class="caption">plot of chunk vis-plot</p>
</div>

Der er meget andet man kan lege med her.

{% include links.md %}

